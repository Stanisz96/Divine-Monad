@model DivineMonad.Engine.Raport.RaportGenerator

@{ 
    Layout = "_SubLayout";
    int n = 1;
}

<div class="game-content-raport">
    <div class="row opponent mb-4">
        <div class="col">
            <img src="@Url.Content("~/images/avatars/sir_deevis2.jpg")"
                 class="character-avatar" alt="avatar">
        </div>
    </div>
    <div class="row quick raport vertical-scroll">
        <div class="col">
            <div id="quick-raport">
                <p>The fight between @Model.Player.Name and @Model.Opponent.Name has begun.</p>
                @foreach (var round in Model.Rounds)
                {
                    <div id="@n">
                        @round.Attacker.Name <span>inflict a hit for @round.Attacker.Damage damage.</span> <br />
                        @round.Defender.Name <span>takes @round.Defender.Receive damage and is left with @round.Defender.HP HP.</span>
                        <p></p>
                    </div>
                    n++;
                }
                @if (Model.Result == "draw")
                {
                    <div id="@n" class="mt-1">
                        <p>The fight ended in a draw</p>
                    </div>
                }
                else
                {
                    <div id="@n" class="mt-1">
                        <p>@Model.Player.Name <span></span> @Model.Result <span> the fight.</span></p>
                    </div>
                    if (Model.Result == "win")
                    {
                        <div id="@(n+1)" class="mt-1">
                            Reward: <br />
                            Gold: @Model.Reward.Gold G <br />
                            Exp.: @Model.Reward.Experience exp <br />
                            @if (!(Model.Reward.ItemName is null))
                            {
                                <span>Item: @Model.Reward.ItemName *@Model.Reward.ItemRarity*</span>
                            }
                        </div>
                    }
                }
            </div>
        </div>
    </div>
    <div class="row slow raport vertical-scroll">
        <div class="col" id="slow-raport">
            <p>The fight between @Model.Player.Name and @Model.Opponent.Name has begun.</p>
        </div>
    </div>
    <div class="row player mt-4">
        <div class="col">
            <div class="float-right">
                <img src="@Url.Content("~/images/avatars/sir_deevis2.jpg")"
                     class="character-avatar" alt="avatar">
            </div>
        </div>
    </div>
</div>

@section Scripts{ 
    <script>
        var quickFight = '@(Model.QuickFight)' === '@true';
        $(document).ready(function (e) {
            $("html").scrollTop(0);

            var quickRaport = $("#quick-raport").children();
            var slowRaport = $("#slow-raport");
            var i = 1;

            if (quickFight) {
                $(".slow").css({ display: "none" });
                $(".quick").animate({ scrollTop: $("#quick-raport").height() }, 1000);
                updateCharacterInfo();
            } else {
                $(".quick").css({ display: "none" });

                var interval = setInterval(function () {
                    if (i < quickRaport.length) {
                        $(quickRaport[i]).hide().appendTo(slowRaport).fadeIn(1000);
                        if (i > 3) {
                            $(".slow").animate({ scrollTop: $("#slow-raport").height() }, 1000);
                        }
                    } else {
                        updateCharacterInfo();
                        clearInterval(interval)
                    }
                    i++;
                }, 1500);
            }
        });

        function updateCharacterInfo() {
            let gold = @ViewBag.gold;
            let exp = @ViewBag.exp;
            let reqExp = @ViewBag.reqExp;
            let level = @ViewBag.level;
            if (exp != $("#character-exp").text()) {
                $("#character-exp").fadeOut(300, function () {
                    $(this).text(exp.toString()).fadeIn(300);
                });
            }
            if (gold != $("#character-gold").text()) {
                $("#character-gold").fadeOut(300, function () {
                    $(this).text(gold.toString()).fadeIn(300);
                })
            }
            if (reqExp != $("#character-reqExp").text()) {
                $("#character-reqExp").fadeOut(300, function () {
                    $(this).text(reqExp.toString()).fadeIn(300);
                })
            }
            if (level != $("#character-level").text()) {
                $("#character-level").fadeOut(300, function () {
                    $(this).text(level.toString()).fadeIn(300);
                })
            }
        }
    </script>
}